# Task: Add task-level and chain-level hook contexts

**Chain**: CHAIN-067-hook-system-design  
**Task**: 006-006  
**Status**: done  
**Type**: impl  
**Created**: 2025-12-13

---

## Objective

Extend hook support to task-level and chain-level contexts. Currently hooks are only on workflow stages. Add support for hooks on task lifecycle events (`onStart`, `onSubmit`, `onApprove`, `onReject`) and chain lifecycle events (`onStart`, `onComplete`, `onApprove`, `onReject`).

---

## Expected Files

- `packages/core/src/workflow/types.ts` — Add task/chain hook types
- `packages/core/src/workflow/hook-runner.ts` — Add task/chain hook execution methods
- `packages/core/src/tasks/types.ts` — Add hook definitions to Task type (if needed)
- `packages/core/src/workflow/__tests__/hook-runner.test.ts` — Tests for task/chain hooks

---

## Acceptance Criteria

- [x] `TaskHooks` type with `onStart`, `onSubmit`, `onApprove`, `onReject`
- [x] `ChainHooks` type with `onStart`, `onComplete`, `onApprove`, `onReject`
- [x] `TransitionHookRunner.runTaskHook(hookName, task, context)` method
- [x] `TransitionHookRunner.runChainHook(hookName, chain, context)` method
- [x] Hook definitions can be in task files or chain metadata
- [x] Unit tests for task and chain hooks
- [x] `pnpm --filter @choragen/core test` passes

---

## Notes

**Completed 2025-12-12**: Added `TaskHooks`/`ChainHooks` types, optional `hooks` fields on `Task`/`Chain`, `runTaskHook`/`runChainHook` methods with generalized action runner, updated `HookRunResult` for task/chain metadata. Added 2 unit tests with interpolation.

---

## Task Type Reference

- **impl** (default): Requires handoff to implementation agent in a fresh session
- **control**: Control agent executes directly (e.g., verification, review, closure tasks)
