# Task: Add template variable interpolation

**Chain**: CHAIN-067-hook-system-design  
**Task**: 005-005  
**Status**: done  
**Type**: impl  
**Created**: 2025-12-13

---

## Objective

Add template variable interpolation to hook definitions. Variables like `{{taskId}}`, `{{chainId}}`, `{{workflowId}}`, `{{requestId}}` should be replaced with actual values from the hook context.

---

## Expected Files

- `packages/core/src/workflow/hook-runner.ts` — Add interpolation logic
- `packages/core/src/workflow/__tests__/hook-runner.test.ts` — Tests for interpolation

---

## Acceptance Criteria

- [x] `interpolateTemplate(template: string, context: TransitionHookContext)` function
- [x] Supports `{{taskId}}`, `{{chainId}}`, `{{workflowId}}`, `{{stageIndex}}`
- [x] Interpolation applied to all string properties in actions
- [x] Handles missing variables gracefully (leave as-is or empty string)
- [x] Unit tests for template interpolation
- [x] `pnpm --filter @choragen/core test` passes

---

## Notes

**Completed 2025-12-12**: Implemented `interpolateTemplate` (exported), recursive `interpolateValue` helper for nested objects/arrays, and `interpolateAction` wrapper. Actions are interpolated before execution in `runHook`. Added 2 unit tests.

---

## Task Type Reference

- **impl** (default): Requires handoff to implementation agent in a fresh session
- **control**: Control agent executes directly (e.g., verification, review, closure tasks)
